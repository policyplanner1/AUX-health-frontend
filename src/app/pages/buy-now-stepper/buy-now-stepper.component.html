<!-- ============================
     BUY-NOW STEPPER COMPONENT
============================== -->
  <!-- ============================
       HEADER
  ============================ -->
<div class="stepper-container">



  <!-- Row 1: Proposal Form Title -->
  <div class="header-left">
    <button class="back-btn" (click)="goBack()">
      <svg width="28" height="28" viewBox="0 0 24 24">
        <path d="M15 18l-6-6 6-6" stroke-width="2" stroke="currentColor" fill="none"></path>
      </svg>
    </button>
    <h2 class="stepper-title">Proposal Form</h2>
  </div>

  <!-- Row 2: Steps -->
  <div class="header-center">
    <div class="step-indicators">
      <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
        <div class="step-number">1</div>
        <span class="step-label">Quote</span>
      </div>
      <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
        <div class="step-number">2</div>
        <span class="step-label">Insured</span>
      </div>
      <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
        <div class="step-number">3</div>
        <span class="step-label">Summary</span>
      </div>
    </div>
  </div>

</div>

  <!-- ============================================================
       STEP 1 : PRODUCT + PROPOSER + ADDITIONAL + KYC
  ============================================================ -->

  <div *ngIf="currentStep === 1" class="step-content">

    <!-- ============================
         PRODUCT DETAILS
    ============================ -->
    <div class="product-dropdown-card">
      <h4 class="section-title">Product Details</h4>

      <div class="row-4col">
        <div class="dropdown-group">
          <label>Product Name</label>
          <input class="custom-input" [value]="proposalData.productName" readonly />
        </div>

        <div class="dropdown-group">
          <label>Product Type</label>
          <div class="radio-row">
            <label class="radio-label">
              <input type="radio" value="new" name="ptype" [(ngModel)]="proposalData.selectedProductType" /> New
            </label>
            <label class="radio-label">
              <input type="radio" value="portability" name="ptype" [(ngModel)]="proposalData.selectedProductType" /> Portability
            </label>
          </div>
        </div>

        <div class="dropdown-group" id="pincodeGroup">
          <label>Pincode <span class="mandatory">*</span></label>
         <input
            id="pincodeField"
            class="custom-input"
            maxlength="6"
            [(ngModel)]="proposalData.pincode"
            (keydown)="blockNonDigits($event)"
            (input)="onPincodeChange()"
          />


          <div class="field-error" *ngIf="fieldErrors.pincode">{{ fieldErrors.pincode }}</div>
        </div>

        <div class="dropdown-group">
          <label>City & State</label>
          <input class="custom-input" [value]="proposalData.cityState" readonly />
        </div>
      </div>

      <div class="row-4col">
        <div class="dropdown-group">
          <label>Zone</label>
          <input class="custom-input" [value]="proposalData.zone" readonly />
        </div>

        <div class="dropdown-group">
          <label>Upgrade Zone?</label>
          <div class="radio-row">
            <label><input type="radio" value="yes" [(ngModel)]="proposalData.upgradeZone" /> Yes</label>
            <label><input type="radio" value="no" [(ngModel)]="proposalData.upgradeZone" /> No</label>
          </div>
        </div>

        <div class="dropdown-group col-empty"></div>
        <div class="dropdown-group col-empty"></div>
      </div>
    </div>

    <!-- ============================
         PROPOSER DETAILS
    ============================ -->
    <div class="product-dropdown-card">
      <h4 class="section-title">Proposer Details</h4>

      <div class="row-4col">
        <div class="dropdown-group">
          <label>Proposer Name <span class="mandatory">*</span></label>
 <input
  id="nameField"
  class="custom-input"
  [(ngModel)]="proposalData.proposerName"
  (keydown)="allowOnlyAlphabets($event)"
  (input)="onProposerNameChange()"
/>
    <div class="field-error" *ngIf="fieldErrors.proposerName">
            {{ fieldErrors.proposerName }}
          </div>
        </div>

        <div class="dropdown-group">
          <label>Policy Tenure</label>
          <select id="tenureField" class="custom-dropdown" [(ngModel)]="proposalData.selectedTenure">
            <option value="1">1 Year</option>
            <option value="2">2 Year</option>
            <option value="3">3 Year</option>
            <option value="3">4 Year</option>
            <option value="3">5 Year</option>
          </select>
        </div>

    <!-- Adult Counter -->
<div class="dropdown-group">
  <label>Adult</label>

  <div class="counter-card">
    <div class="counter-left">
      <img src="../../../assets/adult.png" class="counter-icon" alt="">
      <span class="counter-title">Adult</span>
    </div>

    <div class="counter-controls">
      <button class="counter-btn" (click)="changeAdultCount(-1)">−</button>
      <span class="counter-value">{{ adultCount }}</span>
      <button class="counter-btn" (click)="changeAdultCount(1)">+</button>
    </div>
  </div>
</div>

<!-- Child Counter -->
<div class="dropdown-group">
  <label>Child</label>

  <div class="counter-card child-box">
    <div class="counter-left">
      <img src="../../../assets/child.png" class="counter-icon" alt="">
      <span class="counter-title">Child</span>
    </div>

    <div class="counter-controls">
      <button class="counter-btn" (click)="changeChildCount(-1)">−</button>
      <span class="counter-value">{{ childCount }}</span>
      <button class="counter-btn" (click)="changeChildCount(1)">+</button>
    </div>
  </div>
</div>

      </div>

      <!-- ROW 2 -->
      <div class="row-4col">
        <div class="dropdown-group">
          <label>DOB <span class="mandatory">*</span></label>
          <input id="dobField" type="date" class="custom-input"
                 [(ngModel)]="proposalData.proposerDOB" [max]="today" />
          <div class="field-error" *ngIf="fieldErrors.proposerDOB">{{ fieldErrors.proposerDOB }}</div>
        </div>

        <div class="dropdown-group">
          <label>Gender <span class="mandatory">*</span></label>
          <div class="radio-row" id="genderField">
            <label><input type="radio" name="g1" value="Male" [(ngModel)]="proposalData.proposerGender" /> Male</label>
            <label><input type="radio" name="g1" value="Female" [(ngModel)]="proposalData.proposerGender" /> Female</label>
            <label><input type="radio" name="g1" value="Others" [(ngModel)]="proposalData.proposerGender" /> Others</label>
          </div>
          <div class="field-error" *ngIf="fieldErrors.proposerGender">{{ fieldErrors.proposerGender }}</div>
        </div>

        <div class="dropdown-group">
          <label>Phone <span class="mandatory">*</span></label>
          <input id="phoneField" maxlength="10" class="custom-input"
                 [(ngModel)]="proposalData.proposerPhone" />
          <div class="field-error" *ngIf="fieldErrors.proposerPhone">{{ fieldErrors.proposerPhone }}</div>
        </div>

        <div class="dropdown-group">
          <label>Email ID <span class="mandatory">*</span></label>
          <input id="emailField" class="custom-input" [(ngModel)]="proposalData.proposerEmail" />
          <div class="field-error" *ngIf="fieldErrors.proposerEmail">{{ fieldErrors.proposerEmail }}</div>
        </div>
      </div>

      <!-- ROW 3 -->
      <div class="row-4col">
        <div class="dropdown-group">
          <label>Sum Insured <span class="mandatory">*</span></label>
          <select id="sumInsuredField" class="custom-dropdown" [(ngModel)]="proposalData.sumInsured">
            <option disabled value="">Select Sum</option>
            <option value="200000">₹2 Lakh</option>
            <option value="300000">₹3 Lakh</option>
            <option value="400000">₹4 Lakh</option>
            <option value="500000">₹5 Lakh</option>
            <option value="700000">₹7 Lakh</option>
            <option value="1000000">₹10 Lakh</option>
            <option value="1500000">₹15 Lakh</option>
            <option value="2000000">₹20 Lakh</option>
            <option value="2500000">₹25 Lakh</option>
            <option value="5000000">₹50 Lakh</option>
            <option value="10000000">₹1 Crore</option>
            <option value="10000000">₹3 Crores</option>


          </select>
          <div class="field-error" *ngIf="fieldErrors.sumInsured">{{ fieldErrors.sumInsured }}</div>
        </div>
      </div>
    </div>

    <!-- ============================
         ADDITIONAL DETAILS
    ============================ -->
    <div class="product-dropdown-card">
      <h4 class="section-title">Additional Details</h4>

      <div class="row-4col">

        <div class="dropdown-group">
          <label>Applicant Annual Income</label>
          <select class="custom-dropdown" [(ngModel)]="proposalData.annualIncome">
            <option value="5L-10L">₹3 Lakh – ₹5 Lakh</option>
            <option value="10L-20L">₹5 Lakh – ₹8 Lakh</option>
            <option value="20L-30L">₹8 Lakh – ₹12 Lakh</option>
            <option value="20L-30L">₹12 Lakh – ₹18 Lakh</option>
            <option value="20L-30L">₹18 Lakh – ₹25 Lakh</option>
            <option value="20L-30L">₹25 Lakh – ₹40 Lakh</option>
            <option value="20L-30L">₹40 Lakh and Above</option>

          </select>
        </div>

        <div class="dropdown-group">
          <label>Opt for NRI Discount?</label>
          <div class="radio-row">
            <label><input type="radio" value="yes" name="nri" [(ngModel)]="proposalData.nriDiscount" /> Yes</label>
            <label><input type="radio" value="no" name="nri" [(ngModel)]="proposalData.nriDiscount" /> No</label>
          </div>
        </div>

        <div class="dropdown-group">
          <label>Include Yourself in Plan?</label>
          <div class="radio-row">
            <label><input type="radio" value="yes" name="self" [(ngModel)]="proposalData.includeSelf" /> Yes</label>
            <label><input type="radio" value="no" name="self" [(ngModel)]="proposalData.includeSelf" /> No</label>
          </div>
        </div>

        <div class="dropdown-group">
          <label>Discount Based on Bureau?</label>
          <div class="radio-row">
            <label><input type="radio" value="yes" name="bureau" [(ngModel)]="proposalData.bureauDiscount" /> Yes</label>
            <label><input type="radio" value="no" name="bureau" [(ngModel)]="proposalData.bureauDiscount" /> No</label>
          </div>
        </div>

      </div>
    </div>

    <!-- ============================
         KYC DETAILS
    ============================ -->
    <div class="product-dropdown-card">
      <h4 class="section-title">KYC Details</h4>

      <div class="row-4col">
        <div class="dropdown-group">
          <label>Aadhaar Card Number <span class="mandatory">*</span></label>
          <input id="aadhaarField" maxlength="12"
                 class="custom-input" [(ngModel)]="proposalData.aadharNumber" />
          <div class="field-error" *ngIf="fieldErrors.aadharNumber">{{ fieldErrors.aadharNumber }}</div>
        </div>

        <div class="dropdown-group">
          <label>PAN Card <span class="mandatory">*</span></label>
       <input
  id="panNumber"
  class="custom-input"
  maxlength="10"
  [(ngModel)]="proposalData.panNumber"
  (input)="onPanChange()"
  style="text-transform: uppercase;"
/>


          <div class="field-error" *ngIf="fieldErrors.panNumber">{{ fieldErrors.panNumber }}</div>
        </div>
      </div>

      <div class="navigation-buttons">
        <button class="btn btn-secondary" disabled>Previous</button>
        <button class="btn btn-primary" (click)="nextStep()">Next</button>
      </div>
    </div>

  </div>

  <!-- ============================================================
       STEP 2 : INSURED MEMBERS
  ============================================================ -->

  <div *ngIf="currentStep === 2" class="step-content">

    <!-- Summary -->
    <div class="product-dropdown-card">
      <h4 class="section-title">Insured Members</h4>

      <div class="insured-summary-grid">
        <div class="summary-box">Adults: <span>{{ adultCount }}</span></div>
        <div class="summary-box">Children: <span>{{ childCount }}</span></div>
        <div class="summary-box">Total: <span>{{ adultCount + childCount }}</span></div>
      </div>
    </div>

    <!-- ============================
         ADULT LOOP
    ============================ -->
    <div *ngFor="let adult of adults; let i=index" class="product-dropdown-card">
      <h4 class="section-title">Adult {{ i + 1 }}</h4>

      <!-- ROW 1 -->
      <div class="row-4col">
        <div class="dropdown-group">
          <label>Relationship</label>
          <select class="custom-dropdown" [(ngModel)]="adult.relationship">
            <option value="Self">Self</option>
            <option value="Spouse">Spouse</option>
            <option value="Father">Father</option>
            <option value="Mother">Mother</option>
          </select>
        </div>

        <div class="dropdown-group">
          <label>Title</label>
          <select class="custom-dropdown" [(ngModel)]="adult.title">
            <option value="Mr">Mr</option>
            <option value="Mrs">Mrs</option>
            <option value="Ms">Ms</option>
          </select>
        </div>

        <div class="dropdown-group">
          <label>Full Name</label>
         <input class="custom-input"
       [(ngModel)]="adult.fullName"
       (input)="validateAdultField(i, 'fullName')" />

          <div class="field-error" *ngIf="memberErrors.adults[i]?.fullName">
            {{ memberErrors.adults[i].fullName }}
          </div>

        </div>

        <div class="dropdown-group">
          <label>Date of Birth</label>
          <input type="date"
       class="custom-input"
       [(ngModel)]="adult.dob"
       (change)="validateAdultField(i, 'dob')" />

          <div class="field-error" *ngIf="memberErrors.adults[i]?.dob">
            {{ memberErrors.adults[i].dob }}
          </div>

        </div>
      </div>

      <!-- ROW 2 -->
      <div class="row-4col">
        <div class="dropdown-group">
          <label>Height (cm)</label>
         <input type="number"
       class="custom-input"
       [(ngModel)]="adult.height"
       (input)="validateAdultField(i, 'height')" />

      <div class="field-error" *ngIf="memberErrors.adults[i]?.height">
        {{ memberErrors.adults[i].height }}
      </div>

        </div>

        <div class="dropdown-group">
          <label>Weight (kg)</label>
          <input type="number"
       class="custom-input"
       [(ngModel)]="adult.weight"
       (input)="validateAdultField(i, 'weight')" />

      <div class="field-error" *ngIf="memberErrors.adults[i]?.weight">
        {{ memberErrors.adults[i].weight }}
      </div>

        </div>

        <div class="dropdown-group">
          <label>ABHA ID</label>
          <input class="custom-input" [(ngModel)]="adult.abhaId" />
        </div>

        <!-- MULTI-SELECT DROPDOWN (SCREENSHOT STYLE) -->
        <div class="dropdown-group">
          <label>Select if any pre-existing diseases</label>

          <!-- Display box -->
          <div class="multi-select-box" (click)="toggleDropdown(adult)">
            <span *ngIf="!adult.selectedDiseases?.length">Select Disease</span>
            <span *ngIf="adult.selectedDiseases?.length">
              {{ adult.selectedDiseases.join(', ') }}
            </span>
            <svg [class.rotate]="adult.dropdownOpen" width="20" height="20" viewBox="0 0 24 24">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none"/>
            </svg>
          </div>

          <!-- Dropdown checklist -->
          <div class="multi-select-dropdown" *ngIf="adult.dropdownOpen">
            <label class="multi-option" *ngFor="let dis of diseaseList">
              <input type="checkbox"
                     [checked]="adult.selectedDiseases?.includes(dis)"
                     (change)="toggleDisease(adult, dis)" />
              <span>{{ dis }}</span>
            </label>

            <!-- None of these -->
            <label class="multi-option none-option">
              <input type="checkbox"
                     [checked]="adult.selectedDiseases?.includes('None of these')"
                     (change)="selectNone(adult)" />
              <span>None of these</span>
            </label>
          </div>

        </div>
      </div>

    </div>

    <!-- ============================
         CHILD LOOP
    ============================ -->
    <div *ngFor="let child of children; let i=index" class="product-dropdown-card">
      <h4 class="section-title">Child {{ i + 1 }}</h4>

      <div class="row-4col">
        <div class="dropdown-group">
          <label>Relationship</label>
          <select class="custom-dropdown" [(ngModel)]="child.relationship">
            <option value="Son">Son</option>
            <option value="Daughter">Daughter</option>
          </select>
        </div>

        <div class="dropdown-group">
          <label>Title</label>
          <select class="custom-dropdown" [(ngModel)]="child.title">
            <option value="Master">Master</option>
            <option value="Miss">Miss</option>
          </select>
        </div>

        <div class="dropdown-group">
          <label>Full Name</label>
          <input class="custom-input" [(ngModel)]="child.fullName" />
        </div>

        <div class="dropdown-group">
          <label>Date of Birth</label>
          <input type="date" class="custom-input" [(ngModel)]="child.dob" [max]="today" />
        </div>
      </div>

      <!-- ROW 2 -->
      <div class="row-4col">
        <div class="dropdown-group">
          <label>Height (cm)</label>
          <input class="custom-input" type="number" [(ngModel)]="child.height" />
        </div>

        <div class="dropdown-group">
          <label>Weight (kg)</label>
          <input class="custom-input" type="number" [(ngModel)]="child.weight" />
        </div>

        <div class="dropdown-group">
          <label>ABHA ID</label>
          <input class="custom-input" [(ngModel)]="child.abhaId" />
        </div>

       <!-- MULTI-SELECT DROPDOWN -->
<div class="dropdown-group">
  <label>Select if any pre-existing diseases</label>

  <div class="multi-select-box" (click)="toggleDropdown(child)">
    <span *ngIf="!child.selectedDiseases?.length">Select Disease</span>
    <span *ngIf="child.selectedDiseases?.length">
      {{ child.selectedDiseases.join(', ') }}
    </span>

    <svg [class.rotate]="child.dropdownOpen" width="20" height="20" viewBox="0 0 24 24">
      <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none"/>
    </svg>
  </div>

  <!-- FIXED: Proper floating dropdown -->
  <div class="multi-select-dropdown" *ngIf="child.dropdownOpen">
    <div class="multi-option" *ngFor="let dis of diseaseList">
      <input type="checkbox"
             [checked]="child.selectedDiseases?.includes(dis)"
             (change)="toggleDisease(child, dis)" />
      <span>{{ dis }}</span>
    </div>

    <div class="multi-option none-option">
      <input type="checkbox"
             [checked]="child.selectedDiseases?.includes('None of these')"
             (change)="selectNone(child)" />
      <span>None of these</span>
    </div>
  </div>

</div>

      </div>

    </div>

    <!-- NAVIGATION -->
    <div class="navigation-buttons">
      <button class="btn btn-secondary" (click)="previousStep()">Previous</button>
      <button class="btn btn-primary" (click)="nextStep()">Next</button>
    </div>

  </div>
<!-- ============================
     STEP 3 : SUMMARY (FIXED)
============================ -->
<div *ngIf="currentStep === 3" class="step-content">
  <div class="product-dropdown-card summary-wrapper">

<h2 class="proposal-summary-heading">Proposal Summary</h2>

    <!-- ======================
         TOP 3 BOX SUMMARY
    ======================= -->
    <div class="summary-grid">

      <!-- PRODUCT DETAILS -->
      <div class="summary-card">
  <h3 class="summary-card-title">Product Details</h3>

        <div class="summary-item"><label>Product Name</label><span>{{ proposalData.productName || '—' }}</span></div>
        <div class="summary-item"><label>Product Type</label><span>{{ proposalData.selectedProductType === 'new' ? 'New' : 'Portability' }}</span></div>
        <div class="summary-item"><label>Pincode</label><span>{{ proposalData.pincode || '—' }}</span></div>
        <div class="summary-item"><label>City & State</label><span>{{ proposalData.cityState || '—' }}</span></div>
        <div class="summary-item"><label>Zone</label><span>{{ proposalData.zone || '—' }}</span></div>
        <div class="summary-item"><label>Upgrade Zone</label><span>{{ proposalData.upgradeZone === 'yes' ? 'Yes' : 'No' }}</span></div>

      </div>

      <!-- INSURED DETAILS -->
      <div class="summary-card">
        <h5 class="summary-heading">Insured Details</h5>

        <div class="summary-item"><label>Adults</label><span>{{ adultCount }}</span></div>
        <div class="summary-item"><label>Children</label><span>{{ childCount }}</span></div>
        <div class="summary-item"><label>Total Members</label><span>{{ adultCount + childCount }}</span></div>
        <div class="summary-item"><label>Policy Tenure</label>
          <span>{{ proposalData.selectedTenure }} {{ proposalData.selectedTenure > 1 ? 'years' : 'year' }}</span>
        </div>
        <div class="summary-item"><label>Sum Insured</label><span>{{ sumInsuredDisplay }}</span></div>

        <div class="summary-item" *ngIf="proposalData.siRange">
          <label>SI Range</label><span>{{ proposalData.siRange }}</span>
        </div>
      </div>

      <!-- ADDITIONAL DETAILS -->
      <div class="summary-card">
        <h5 class="summary-heading">Additional Details</h5>

        <div class="summary-item"><label>Annual Income</label><span>{{ annualIncomeDisplay }}</span></div>

        <div class="summary-item"><label>Pre-existing Conditions</label>
          <span>{{ hasPreExistingCondition() ? 'Yes' : 'No' }}</span>
        </div>

        <div class="summary-item"><label>NRI Discount</label><span>{{ proposalData.nriDiscount === 'yes' ? 'Yes' : 'No' }}</span></div>

        <div class="summary-item"><label>Include Self</label><span>{{ proposalData.includeSelf === 'yes' ? 'Yes' : 'No' }}</span></div>

        <div class="summary-item"><label>Bureau Discount</label><span>{{ proposalData.bureauDiscount === 'yes' ? 'Yes' : 'No' }}</span></div>
      </div>

    </div>



    <!-- ======================
         ADULT DETAILS
    ======================= -->
    <div class="member-section" *ngIf="adults?.length">
      <h3 class="summary-heading">Adult Details</h3>

      <div class="member-card" *ngFor="let a of adults; let i = index">

        <div class="member-row">
          <div class="field"><label>Relationship</label><span>{{ a.relationship }}</span></div>
          <div class="field"><label>Title</label><span>{{ a.title }}</span></div>
          <div class="field"><label>Full Name</label><span>{{ a.fullName }}</span></div>
          <div class="field"><label>Date of Birth</label><span>{{ a.dob }}</span></div>

          <div class="field"><label>Height</label><span>{{ a.height }} cm</span></div>
          <div class="field"><label>Weight</label><span>{{ a.weight }} kg</span></div>
          <div class="field"><label>ABHA ID</label><span>{{ a.abhaId }}</span></div>

          <div class="field"><label>Pre-existing Condition</label>
            <span>{{ a.selectedDiseases?.join(', ') || 'None' }}</span>
          </div>
        </div>

      </div>
    </div>


    <!-- ======================
         CHILD DETAILS
    ======================= -->
    <div class="member-section" *ngIf="children?.length">
      <h3 class="summary-heading">Child Details</h3>

      <div class="member-card" *ngFor="let c of children; let i = index">

        <div class="member-row">
          <div class="field"><label>Relationship</label><span>{{ c.relationship }}</span></div>
          <div class="field"><label>Title</label><span>{{ c.title }}</span></div>
          <div class="field"><label>Full Name</label><span>{{ c.fullName }}</span></div>
          <div class="field"><label>Date of Birth</label><span>{{ c.dob }}</span></div>

          <div class="field"><label>Height</label><span>{{ c.height }} cm</span></div>
          <div class="field"><label>Weight</label><span>{{ c.weight }} kg</span></div>
          <div class="field"><label>ABHA ID</label><span>{{ c.abhaId }}</span></div>

          <div class="field"><label>Pre-existing Condition</label>
            <span>{{ c.selectedDiseases?.join(', ') || 'None' }}</span>
          </div>
        </div>

      </div>
    </div>


    <!-- Buttons -->
    <div class="navigation-buttons">
      <button class="btn btn-secondary" (click)="previousStep()">Previous</button>
      <button class="btn btn-primary" (click)="completePurchase()">Submit Details</button>
    </div>
    <!-- KYC Verification Popup -->
      <div class="popup-overlay" *ngIf="showPopup">
        <div class="popup-box">
          <img src="assets/popup.svg" class="popup-img" alt="verifying">
          <h3>We’re verifying your KYC details</h3>
          <p>Sit tight! Once your verification is complete, we’ll send a secure payment link to your registered email so you can easily complete the process.</p>
          <button class="btn btn-primary" (click)="closePopup()">Go Back</button>
        </div>
      </div>

  </div>
</div>
